geom_boxplot() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_combined_meta_genome_box_no_burnin_plt
save_plot_defaults(file.path(output_dir, current_run_id, "host_fitness_mean_by_zygosity_box_no_burnin.png"), run_host_data_combined_meta_genome_box_no_burnin_plt, 5000, 3000)
run_host_genome_zygosity_counts = run_host_genome_data_combined_meta %>%
mutate(zygosity = case_when(
allele_1_id == allele_2_id ~ "homozygous",
allele_1_id != allele_2_id ~ "heterozygous"
)) %>%
group_by(config_id, generation, species, locus_id) %>%
count(zygosity, name = "zygosity_count") %>%
pivot_wider(names_from = zygosity, values_from = zygosity_count) %>%
mutate(hobs = heterozygous/(homozygous+heterozygous))
## calculate hobserved vs hexpected
run_host_genome_zygosity_counts = run_host_genome_data_combined_meta %>%
mutate(zygosity = case_when(
allele_1_id == allele_2_id ~ "homozygous",
allele_1_id != allele_2_id ~ "heterozygous"
)) %>%
group_by(config_id, generation, species, locus_id) %>%
count(zygosity, name = "zygosity_count") %>%
pivot_wider(names_from = zygosity, values_from = zygosity_count) %>%
mutate(hobs = heterozygous/(homozygous+heterozygous))
run_host_genome_hobs_hexp = run_host_genome_zygosity_counts %>%
left_join(run_host_allele_data_hexp, by = c("config_id", "generation", "species", "locus_id")) %>%
mutate(hobsoverhexp = hobs/hexp) %>%
mutate(hobsminushexp = hobs-hexp)
run_host_genome_hobs_hexp_plt = ggplot(run_host_genome_hobs_hexp) +
aes(
x = generation,
facet = config_id
) +
geom_line(aes(y = hobs, color = "blue")) +
geom_line(aes(y = hexp, color = "red")) +
scale_color_discrete(name = "Heterozygosity", labels = c("Hexp","Hobs")) +
geom_vline(xintercept = as.numeric(run_config_common[1,"burnin_generations"])) +
theme_minimal() +
facet_wrap(
vars(config_id),
)
run_host_genome_hobs_hexp_plt
save_plot_defaults(file.path(output_dir, current_run_id, "host_heterozygosity.png"), run_host_genome_hobs_hexp_plt, 5000, 3000)
run_host_data_combined_meta_genome_longer_by_allele = run_host_data_combined_meta_genome %>%
pivot_longer(cols = c("allele_1_id", "allele_2_id"), names_to = "chromosome", values_to = "allele_id")
run_host_data_marginal_fitness_summary_no_burnin = run_host_data_combined_meta_genome_longer_by_allele %>%
filter(bBurninMode == FALSE) %>%
group_by(config_id, generation, species, allele_id) %>%
summarise(marginal_fitness_mean = mean(fitness), marginal_fitness_sd = sd(fitness), marginal_fitness_cv = cv(fitness), .groups = "keep")
run_host_data_marginal_fitness_mean_plt = ggplot(run_host_data_marginal_fitness_summary_no_burnin) +
aes(
x = generation,
y = marginal_fitness_mean,
group = allele_id,
color = allele_id,
facet = config_id
) +
geom_point() +
theme_minimal() +
scale_color_viridis_c(option = "turbo") +
facet_wrap(
vars(config_id)
)
run_host_data_marginal_fitness_mean_plt
run_host_data_marginal_fitness_mean_box_plt = ggplot(run_host_data_marginal_fitness_summary) +
aes(
x = generation,
y = marginal_fitness_mean,
group = generation,
facet = config_id
) +
geom_boxplot() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_marginal_fitness_mean_box_plt = ggplot(run_host_data_marginal_fitness_summary_no_burnin) +
aes(
x = generation,
y = marginal_fitness_mean,
group = generation,
facet = config_id
) +
geom_boxplot() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_marginal_fitness_mean_box_plt
run_host_data_marginal_fitness_mean_box_no_burnin_plt = ggplot(run_host_data_marginal_fitness_summary_no_burnin) +
aes(
x = generation,
y = marginal_fitness_mean,
group = generation,
color = config_id,
facet = config_id
) +
geom_boxplot() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_marginal_fitness_mean_box_no_burnin_plt
run_host_data_marginal_fitness_mean_box_no_burnin_plt = ggplot(run_host_data_marginal_fitness_summary_no_burnin) +
aes(
x = generation,
y = marginal_fitness_mean,
group = generation,
color = config_id,
facet = config_id
) +
geom_violin() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_marginal_fitness_mean_box_no_burnin_plt
# plt: fitness mean over time
#TODO(JAN): add CI whiskers
run_host_data_fitness_mean_over_time_plt_autoscale <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_median,
group = interaction(config_id, species),
color = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_line() +
theme_minimal()
run_host_data_fitness_mean_over_time_plt_autoscale
# plt: fitness mean over time
#TODO(JAN): add CI whiskers
run_host_data_fitness_mean_over_time_plt_autoscale <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_line() +
theme_minimal()
run_host_data_fitness_mean_over_time_plt_autoscale
# plt: fitness mean over time
#TODO(JAN): add CI whiskers
run_host_data_fitness_mean_over_time_plt_autoscale <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_errorbar(aes(ymin = fitness_mean - fitness_sd, ymax = fitness_mean - fitness_sd), width=0.5) +
geom_line() +
theme_minimal()
run_host_data_fitness_mean_over_time_plt_autoscale
# plt: fitness mean over time
#TODO(JAN): add CI whiskers
run_host_data_fitness_mean_over_time_plt_autoscale <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_errorbar(aes(ymin = fitness_mean - fitness_sd, ymax = fitness_mean + fitness_sd), width=0.5) +
geom_line() +
theme_minimal()
run_host_data_fitness_mean_over_time_plt_autoscale
run_host_data_fitness_mean_over_time_plt_autoscale_facet <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id,
facet = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_errorbar(aes(ymin = fitness_mean - fitness_sd, ymax = fitness_mean + fitness_sd), width=0.5) +
geom_line() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_fitness_mean_over_time_plt_autoscale_facet
# plt: fitness mean over time
#TODO(JAN): add CI whiskers
run_host_data_fitness_mean_over_time_plt_autoscale <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_line() +
theme_minimal()
run_host_data_fitness_mean_over_time_plt_autoscale
run_host_data_fitness_mean_over_time_plt_autoscale_facet <- ggplot(run_host_data_fitness_summary_no_burnin) +
aes(
x = generation,
y = fitness_mean,
group = interaction(config_id, species),
color = config_id,
facet = config_id
) +
geom_hline(yintercept = as.numeric(run_config_common[1,"hosts.fitness_minimum"])) +
geom_point() +
geom_line() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_data_fitness_mean_over_time_plt_autoscale_facet
run_host_data_fitness_summary_last = run_host_data_fitness_summary %>% filter(generation == max(generation))
## host fitness distribution
run_host_allele_data_combined_meta_last_generation = run_host_data_combined_meta %>%
group_by(config_id, generation, species, bBurninMode) %>%
filter(generation == max(generation))
## host fitness distribution
run_host_data_combined_meta_last_generation = run_host_data_combined_meta %>%
group_by(config_id, generation, species, bBurninMode) %>%
filter(generation == max(generation))
View(run_host_data_combined_meta_last_generation)
## host fitness distribution
run_host_data_combined_meta_last_generation = run_host_data_combined_meta %>%
filter(generation == max(generation)) %>%
group_by(config_id, generation, species, bBurninMode)
View(run_host_data_combined_meta_last_generation)
## host fitness distribution
run_host_data_combined_meta_last_generation = run_host_data_combined_meta %>%
group_by(config_id, bBurninMode) %>%
filter(generation == max(generation))
View(run_host_data_combined_meta_last_generation)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness
) +
geom_density() +
theme_minimal()
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness
) +
geom_bar() +
theme_minimal()
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id
) +
geom_bar() +
theme_minimal()
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = config_id
) +
geom_bar() +
theme_minimal()
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
facet = config_id
) +
geom_bar() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_data_successful_presentation_dist_plt
run_host_data_last_gen_successful_presentation_dist_plt
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
facet = config_id
) +
geom_bar() +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
facet = config_id
) +
geom_bar(aes(color = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness
facet = config_id
) +
geom_bar(aes(color = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(color = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = as.factor(fitness),
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
run_host_data_last_gen_successful_presentation_dist_plt
## successful antigen presentations in the last generation
run_host_data_last_gen_successful_presentation <- run_host_data_combined_meta %>%
group_by(config_id, species) %>%
filter(generation == max(generation)) %>%
mutate(successful_presentations_fac = as.factor(successful_presentations))
run_host_data_last_gen_successful_presentation_dist_plt <- ggplot(run_host_data_last_gen_successful_presentation) +
aes(
x = config_id,
group = successful_presentations,
fill = successful_presentations_fac
) +
geom_bar(position = "dodge") +
theme_minimal()
run_host_data_last_gen_successful_presentation_dist_plt
run_host_data_successful_presentation_dist_plt
## host fitness distribution
run_host_data_combined_meta_last_generation = run_host_data_combined_meta %>%
group_by(config_id, species) %>%
filter(generation == max(generation))
run_host_fitness_density_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_density_plt
save_plot_defaults(file.path(output_dir, current_run_id, "host_fitness_dist_last_gen.png"), run_host_data_successful_presentation_dist_plt, 3000, 1500)
save_plot_defaults(file.path(output_dir, current_run_id, "host_fitness_dist_last_gen.png"), run_host_fitness_dist_plt, 3000, 1500)
## host fitness distribution
run_host_data_combined_meta_no_burnin = run_host_data_combined_meta %>%
group_by(config_id, species) %>%
filter(bBurninMode == FALSE)
run_host_data_combined_meta_last_generation = run_host_data_combined_meta %>%
group_by(config_id, species) %>%
filter(generation == max(generation))
run_host_data_combined_meta_no_burnin
## host fitness distribution
run_host_data_combined_meta_no_burnin = run_host_data_combined_meta %>%
group_by(config_id, species) %>%
filter(bBurninMode == FALSE)
run_host_fitness_dist_last_gen_plt = ggplot(run_host_data_combined_meta_last_generation) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_dist_last_gen_plt
save_plot_defaults(file.path(output_dir, current_run_id, "host_fitness_dist_last_gen.png"), run_host_fitness_dist_last_gen_plt, 3000, 1500)
run_host_fitness_dist_no_burnin_plt
run_host_fitness_dist_no_burnin_plt = ggplot(run_host_data_combined_meta_no_burnin) +
aes(
x = fitness,
group = config_id,
color = fitness,
fill = fitness,
facet = config_id
) +
geom_bar(aes(fill = fitness)) +
theme_minimal() +
facet_wrap(
vars(config_id)
)
run_host_fitness_dist_no_burnin_plt
run_host_fitness_dist_no_burnin_plt
save_plot_defaults(file.path(output_dir, current_run_id, "host_fitness_dist_no_burnin.png"), run_host_fitness_dist_no_burnin_plt, 3000, 1500)
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
run_host_data_marginal_fitness_summary_frequencies = run_host_data_marginal_fitness_summary_no_burnin %>%
left_join(run_host_allele_data_combined, by = c("config_id", "generation", "species", "allele_id"))
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
rm(list = ls())
library(tools)
library(rjson)
library(jsonlite)
library(goeveg)
library(tidyverse)
library(plotly)
library(Cairo)
library(esquisse)
source("./help.R")
data_dir <- "./data"
current_run_id <- "2022-07-14-24"
current_run_path <- file.path(data_dir, current_run_id)
output_dir <- "./output"
process_run_data <- function(data_dir, run_id) {
run_path = file.path(data_dir, run_id)
}
# read confings
run_configs = read_run_configs(current_run_path)
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
source("C:/Users/Jan/projects/sim-analysis/prelim.R")
